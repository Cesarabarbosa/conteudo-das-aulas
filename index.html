<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Conte√∫do das Aulas ‚Äî 3 PDFs com busca</title>

<!-- CSS do PDF.js (necess√°rio para o layout do viewer) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/web/pdf_viewer.css">

<style>
  :root{--bg:#0f172a;--panel:#0b1224;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937;--accent:#22c55e}
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
  header{
    position:sticky;top:0;z-index:10;background:#111827;padding:10px 12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;border-bottom:1px solid var(--border)
  }
  .btn{border:1px solid var(--border);background:#111827;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--accent);color:#052012;border:none}
  .tip{color:var(--muted);font-size:12px}
  .wrap{max-width:1200px;margin:0 auto;padding:12px;display:grid;gap:16px}
  .card{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#0b1224}
  .card-head{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;background:#0c1631}
  .title{font-weight:700}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;color:#dbeafe;background:#0b2a5f;border:1px solid #1d4ed8;border-radius:999px;padding:4px 8px;display:none}
  .badge.on{display:inline-block}
  /* √Årea scroll do PDF renderizado pelo PDF.js */
  .scroll{height:75vh;overflow:auto;background:#060b19}
  @media (max-width:600px){ .scroll{height:70vh} }
  .pdfViewer .page{box-shadow:0 6px 22px rgba(0,0,0,.35)}
  .status{padding:8px 12px;border-top:1px solid var(--border);color:var(--muted);font-size:12px}
  a.link{color:#93c5fd;text-decoration:none}
  a.link:hover{text-decoration:underline}
</style>
</head>
<body>
  <header>
    <button id="btnSearch" class="btn primary">üîé Buscar no PDF ativo</button>
    <span class="tip">Toque em um PDF para ativ√°-lo. O bot√£o aplica a busca s√≥ nele.</span>
  </header>

  <main class="wrap">
    <!-- 1) Aula de cer√¢mica -->
    <section class="card" data-key="aula" data-src="pdfs/aula-de-deceramica.pdf">
      <div class="card-head">
        <span class="title">1) Aula de cer√¢mica</span>
        <div class="actions">
          <span class="badge" data-badge>A T I V O</span>
          <a class="btn link" target="_blank" href="pdfs/aula-de-deceramica.pdf">Abrir</a>
          <a class="btn link" download href="pdfs/aula-de-deceramica.pdf">Baixar</a>
        </div>
      </div>
      <div class="scroll" data-container>
        <div class="pdfViewer" data-viewer></div>
      </div>
      <div class="status" data-status>Carregando‚Ä¶</div>
    </section>

    <!-- 2) Esmalte cer√¢mico -->
    <section class="card" data-key="esmalte" data-src="pdfs/esmalte-ceramico.pdf">
      <div class="card-head">
        <span class="title">2) Esmalte cer√¢mico</span>
        <div class="actions">
          <span class="badge" data-badge>A T I V O</span>
          <a class="btn link" target="_blank" href="pdfs/esmalte-ceramico.pdf">Abrir</a>
          <a class="btn link" download href="pdfs/esmalte-ceramico.pdf">Baixar</a>
        </div>
      </div>
      <div class="scroll" data-container>
        <div class="pdfViewer" data-viewer></div>
      </div>
      <div class="status" data-status>Carregando‚Ä¶</div>
    </section>

    <!-- 3) Torno -->
    <section class="card" data-key="torno" data-src="pdfs/torno.pdf">
      <div class="card-head">
        <span class="title">3) Torno</span>
        <div class="actions">
          <span class="badge" data-badge>A T I V O</span>
          <a class="btn link" target="_blank" href="pdfs/torno.pdf">Abrir</a>
          <a class="btn link" download href="pdfs/torno.pdf">Baixar</a>
        </div>
      </div>
      <div class="scroll" data-container>
        <div class="pdfViewer" data-viewer></div>
      </div>
      <div class="status" data-status>Carregando‚Ä¶</div>
    </section>
  </main>

  <!-- PDF.js em m√≥dulo (sem iframe do viewer) -->
  <script type="module">
    import * as pdfjsLib from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.mjs";
    import { EventBus, PDFViewer, PDFFindController, PDFLinkService } from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/web/pdf_viewer.mjs";

    // Worker do PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.mjs";

    const cards = [...document.querySelectorAll(".card")];
    const state = {};
    let activeKey = null;

    function setBadge(card, on){
      const b = card.querySelector("[data-badge]");
      b.classList.toggle("on", !!on);
    }
    function setStatus(card, msg){
      card.querySelector("[data-status]").textContent = msg;
    }

    function mountViewer(card){
      const key        = card.getAttribute("data-key");
      const pdfUrl     = card.getAttribute("data-src");
      const container  = card.querySelector("[data-container]");
      const viewerEl   = card.querySelector("[data-viewer]");

      const eventBus = new EventBus();
      const linkService = new PDFLinkService({ eventBus, externalLinkTarget: 2 }); // 2=_blank
      const findController = new PDFFindController({ eventBus, linkService });

      const pdfViewer = new PDFViewer({
        container,
        viewer: viewerEl,
        eventBus,
        linkService,
        findController,
        textLayerMode: 2,
        annotationMode: 2,
        enableScripting: false
      });

      linkService.setViewer(pdfViewer);

      state[key] = {
        card, container, viewerEl, eventBus, linkService, findController, pdfViewer,
        loadingTask: null, pdfDoc: null, lastQuery: ""
      };

      // Tornar ativo ao tocar/rolar
      container.addEventListener("pointerdown", () => {
        activeKey = key;
        cards.forEach(c => setBadge(c, c === card));
      }, {passive:true});

      // Carregar PDF
      (async () => {
        try {
          setStatus(card, "Carregando‚Ä¶");
          const task = pdfjsLib.getDocument({ url: pdfUrl, withCredentials: false });
          state[key].loadingTask = task;
          const doc = await task.promise;
          state[key].pdfDoc = doc;
          pdfViewer.setDocument(doc);
          linkService.setDocument(doc, null);

          eventBus.on("pagesinit", () => {
            pdfViewer.currentScaleValue = "page-width";
          }, { once: true });

          setStatus(card, `Carregado: ${doc.numPages} p√°gina(s). Toque aqui para ativar e usar o bot√£o de busca.`);
        } catch (err) {
          console.error("Erro ao carregar", key, err);
          setStatus(card, "Falha ao carregar o PDF. Use os bot√µes Abrir/Baixar acima.");
        }
      })();
    }

    // Busca com bot√£o √∫nico
    function doSearch(){
      if (!activeKey){ alert("Toque primeiro em um dos PDFs para ativ√°-lo."); return; }
      const s = state[activeKey];
      if (!s || !s.pdfDoc){ alert("PDF ainda n√£o carregado."); return; }

      const q = prompt("Digite a palavra/frase para buscar:");
      if (!q) return;

      s.lastQuery = q.trim();
      s.findController.executeCommand("find", {
        query: s.lastQuery,
        phraseSearch: true,
        caseSensitive: false,
        entireWord: false,
        highlightAll: true,
        findPrevious: false
      });
    }

    // Inicializa os 3 viewers
    cards.forEach(mountViewer);
    document.getElementById("btnSearch").addEventListener("click", doSearch);
  </script>
</body>
</html>
